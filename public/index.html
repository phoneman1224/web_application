<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#ff7b54" />
    <title>Reseller Ops</title>
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/icons/reseller-ops-icon.svg" sizes="any" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="/icons/reseller-ops-icon.svg" />
    <link rel="stylesheet" href="/styles.css?v=9" />
  </head>
  <body class="theme-light">
    <div class="app-shell">
      <header class="topbar">
        <button class="menu-toggle" id="menu-toggle" aria-label="Toggle menu">
          <span class="hamburger"></span>
        </button>
        <div class="brand">
          <span class="logo">RO</span>
          <div>
            <p class="title">Reseller Ops</p>
            <p class="subtitle">Profit + compliance cockpit</p>
          </div>
        </div>
        <div class="topbar-actions">
          <div class="search-field">
            <input id="global-search" type="search" placeholder="Global search items, lots, sales, expenses" />
            <div id="global-search-results" class="search-results"></div>
          </div>
          <button class="btn ghost" id="export-csv">Export CSV</button>
          <button class="btn primary" id="new-entry">New entry</button>
        </div>
      </header>
      <aside class="sidebar">
        <nav>
          <button class="nav-link active" data-screen="dashboard">Dashboard</button>
          <button class="nav-link" data-screen="inventory">Inventory</button>
          <button class="nav-link" data-screen="sales">Sales</button>
          <button class="nav-link" data-screen="expenses">Expenses</button>
          <button class="nav-link" data-screen="lots">Lots & Bundles</button>
          <button class="nav-link" data-screen="pricing">Pricing & SEO</button>
          <button class="nav-link" data-screen="ebay-valuation">üè∑Ô∏è eBay Valuation</button>
          <button class="nav-link" data-screen="reports">Reports (Tax Prep)</button>
          <button class="nav-link" data-screen="settings">Settings</button>
        </nav>
        <div class="sidebar-footer">
          <p class="status-pill">Auth: Zero Trust enforced</p>
          <p class="quiet">All numbers auto-saved</p>
        </div>
      </aside>
      <main class="content">
        <section class="screen active" id="screen-dashboard">
          <div class="screen-header">
            <div>
              <h1>Dashboard</h1>
              <p>Quiet progress reinforcement and next steps.</p>
            </div>
            <div class="inline-grid">
              <div class="kpi">
                <p class="label">Net profit (MTD)</p>
                <p class="value positive">$0.00</p>
                <p class="assist">Why is this number what it is?</p>
              </div>
              <div class="kpi">
                <p class="label">Sales tax liability</p>
                <p class="value warning">$0.00</p>
                <p class="assist">Florida liability only (non-eBay)</p>
              </div>
              <div class="kpi">
                <p class="label">Drafts ready to list</p>
                <p class="value">0</p>
                <p class="assist">Ready to List filter active</p>
              </div>
            </div>
          </div>
          <div class="panel-grid">
            <article class="panel">
              <h2>What should I do next?</h2>
              <ul class="next-list" id="next-actions"></ul>
            </article>
            <article class="panel">
              <h2>Progress signals</h2>
              <div class="timeline">
                <div class="timeline-item muted">No activity yet. Add inventory or expenses to see progress signals.</div>
              </div>
            </article>
            <article class="panel wide">
              <h2>Why is this number what it is?</h2>
              <div class="drilldown">
                <div>
                  <p>Revenue sources</p>
                  <strong>Sales only</strong>
                  <p class="muted">Pricing drafts never affect accounting.</p>
                </div>
                <div>
                  <p>Tax jar estimate</p>
                  <strong>$0.00</strong>
                  <p class="muted">Federal only. Florida liability tracked separately.</p>
                </div>
                <div>
                  <p>Expenses split</p>
                  <strong>No expenses yet</strong>
                  <p class="muted">Add expenses to see the split between inventory and operations.</p>
                </div>
              </div>
            </article>

            <!-- eBay Activity Summary Widget -->
            <article class="panel">
              <h2>üì¶ eBay Activity</h2>
              <div class="inline-grid">
                <div class="kpi">
                  <p class="value" id="ebay-active-count">0</p>
                  <p class="label">Active Listings</p>
                </div>
                <div class="kpi">
                  <p class="value" id="ebay-draft-count">0</p>
                  <p class="label">Drafts</p>
                </div>
                <div class="kpi">
                  <p class="value" id="ebay-sold-week">0</p>
                  <p class="label">Sold This Week</p>
                </div>
              </div>
            </article>

            <!-- eBay Action Items Widget -->
            <article class="panel">
              <h2>‚ö†Ô∏è Action Items</h2>
              <ul class="next-list" id="ebay-action-items">
                <li class="muted">Loading eBay data...</li>
              </ul>
            </article>

            <!-- eBay Performance Widget -->
            <article class="panel">
              <h2>üìä eBay Performance (MTD)</h2>
              <div class="inline-grid">
                <div class="kpi">
                  <p class="value positive" id="ebay-mtd-sales">$0</p>
                  <p class="label">eBay Sales</p>
                </div>
                <div class="kpi">
                  <p class="value" id="ebay-profit-margin">0%</p>
                  <p class="label">Profit Margin</p>
                </div>
              </div>
            </article>
          </div>
        </section>

        <section class="screen" id="screen-inventory">
          <div class="screen-header">
            <div>
              <h1>Inventory</h1>
              <p>Searchable dropdowns, global warnings, and inventory status.</p>
            </div>
            <div class="actions">
              <button class="btn" id="add-item">Add item</button>
              <button class="btn secondary" id="import-chatgpt-btn">üìã Import from ChatGPT</button>
              <button class="btn secondary" id="import-ebay-listings-btn">üì• Import from eBay</button>
              <button class="btn ghost" id="ready-filter">Ready to List</button>
            </div>
          </div>
          <div class="panel">
            <div class="searchable-dropdown">
              <input type="text" id="item-search" placeholder="Search items" />
              <div id="item-results" class="search-results"></div>
            </div>
            <div class="table">
              <div class="row header">
                <span>Item</span>
                <span>Status</span>
                <span>Location</span>
                <span>Warnings</span>
                <span></span>
              </div>
              <div class="row">
                <span>Vintage Camera</span>
                <span class="pill draft">Draft</span>
                <span>Bin A2</span>
                <span class="soft-warning">Missing SKU</span>
                <span><button class="btn ghost small">Edit</button></span>
              </div>
              <div class="row">
                <span>Mid-century Lamp</span>
                <span class="pill listed">Listed</span>
                <span>Bin B1</span>
                <span class="soft-warning">Low photos</span>
                <span><button class="btn ghost small">Edit</button></span>
              </div>
              <div class="row">
                <span>Record Player</span>
                <span class="pill ready">Ready</span>
                <span>Bin C4</span>
                <span class="soft-warning">No draft SEO</span>
                <span><button class="btn ghost small">Edit</button></span>
              </div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-sales">
          <div class="screen-header">
            <div>
              <h1>Sales</h1>
              <p>Sales are the only revenue source. Florida tax handled separately.</p>
            </div>
            <div class="actions">
              <button class="btn" id="add-sale">Log sale</button>
              <button class="btn secondary" id="import-ebay-sales-btn">üì• Import eBay Sales</button>
            </div>
          </div>
          <div class="panel">
            <div class="table" style="--columns: 6">
              <div class="row header">
                <span>Order</span>
                <span>Platform</span>
                <span>Profit</span>
                <span>Tax</span>
                <span>Status</span>
                <span></span>
              </div>
              <div class="row">
                <span>#EV-0192</span>
                <span>eBay</span>
                <span class="positive">$128</span>
                <span class="muted">Platform collected</span>
                <span class="pill listed">Settled</span>
                <span><button class="btn ghost small">Why?</button></span>
              </div>
              <div class="row">
                <span>#SF-0441</span>
                <span>Shopify</span>
                <span class="negative">-$12</span>
                <span class="warning">$18 liability</span>
                <span class="pill draft">Pending</span>
                <span><button class="btn ghost small">Why?</button></span>
              </div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-expenses">
          <div class="screen-header">
            <div>
              <h1>Expenses</h1>
              <p>Split expenses across categories with soft warnings.</p>
            </div>
            <div class="actions">
              <button class="btn" id="add-expense">Add expense</button>
            </div>
          </div>
          <div class="panel">
            <div class="table">
              <div class="row header">
                <span>Expense</span>
                <span>Category</span>
                <span>Split</span>
                <span>Receipt</span>
                <span></span>
              </div>
              <div class="row">
                <span>Shipping supplies</span>
                <span>Operations</span>
                <span>50 / 30 / 20</span>
                <span class="pill ready">Uploaded</span>
                <span><button class="btn ghost small">Edit</button></span>
              </div>
              <div class="row">
                <span>Estate sale haul</span>
                <span>Inventory</span>
                <span>100 / 0 / 0</span>
                <span class="soft-warning">Missing receipt</span>
                <span><button class="btn ghost small">Edit</button></span>
              </div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-lots">
          <div class="screen-header">
            <div>
              <h1>Lots & Bundles</h1>
              <p>Lots wrap items without storing pricing.</p>
            </div>
            <div class="actions">
              <button class="btn" id="add-lot">New lot</button>
            </div>
          </div>
          <div class="panel">
            <div class="table" style="--columns: 4">
              <div class="row header">
                <span>Lot</span>
                <span>Items</span>
                <span>Status</span>
                <span></span>
              </div>
              <div class="row">
                <span>Vintage Audio</span>
                <span>4 items</span>
                <span class="pill ready">Ready</span>
                <span><button class="btn ghost small">Inspect</button></span>
              </div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-pricing">
          <div class="screen-header">
            <div>
              <h1>Pricing & SEO (Draft Studio)</h1>
              <p>Drafts never affect accounting until listed.</p>
            </div>
            <div class="actions">
              <button class="btn" id="add-draft">New draft</button>
            </div>
          </div>
          <div class="panel">
            <div class="skeleton-grid">
              <div class="skeleton"></div>
              <div class="skeleton"></div>
              <div class="skeleton"></div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-reports">
          <div class="screen-header">
            <div>
              <h1>Reports (Tax Prep)</h1>
              <p>Unusual items are flagged for attention.</p>
            </div>
            <div class="actions">
              <button class="btn" id="view-tax">Open Tax Jar</button>
            </div>
          </div>
          <div class="panel">
            <div class="report-grid">
              <article>
                <h3>Tax Jar</h3>
                <p class="value">$2,960</p>
                <p class="muted">Federal estimate only</p>
                <button class="btn ghost small" id="tax-drilldown">Why is this number?</button>
              </article>
              <article>
                <h3>Unusual items</h3>
                <ul class="unusual">
                  <li>Record Player: margin below 5%</li>
                  <li>Estate Lot #12: missing receipt</li>
                </ul>
              </article>
              <article>
                <h3>Closed period edits</h3>
                <p class="warning">2 edits awaiting confirmation</p>
              </article>
            </div>
          </div>
        </section>

        <!-- eBay Valuation Screen -->
        <section class="screen" id="screen-ebay-valuation">
          <div class="screen-header">
            <div>
              <h1>eBay Market Valuation</h1>
              <p>Get real-time pricing from sold eBay listings</p>
            </div>
          </div>

          <div class="panel">
            <h3>Get eBay Market Price</h3>

            <!-- Valuation Method Selector -->
            <div class="form-row">
              <label>Valuation Method</label>
              <div class="radio-group">
                <label>
                  <input type="radio" name="valuation-method" value="text" checked />
                  ‚å®Ô∏è Type Item Name (Unlimited, Free)
                </label>
                <label>
                  <input type="radio" name="valuation-method" value="photo" />
                  üì∑ Analyze Photo (<span id="photo-valuations-remaining">12</span>/12 today - uses AI quota)
                </label>
              </div>
            </div>

            <!-- Text-based Valuation Input -->
            <div id="text-valuation-input">
              <div class="form-row">
                <label>
                  <span>Item Name</span>
                  <input type="text" id="valuation-item-name" placeholder="e.g., Vintage Canon AE-1 Camera" />
                </label>
              </div>
              <div class="form-row">
                <button class="btn" id="get-text-valuation-btn">üîç Get Valuation</button>
              </div>
            </div>

            <!-- Photo-based Valuation Input -->
            <div id="photo-valuation-input" style="display:none;">
              <div class="form-row">
                <label>
                  <span>Upload Photo</span>
                  <input type="file" id="valuation-photo" accept="image/*" capture="environment" />
                </label>
              </div>
              <div class="form-row">
                <button class="btn" id="get-photo-valuation-btn">‚ú® Analyze & Value</button>
              </div>
              <p class="muted">AI will detect the item and search eBay for pricing. Uses 800 neurons per valuation.</p>
            </div>

            <!-- Valuation Results -->
            <div id="valuation-results" style="display:none; margin-top: 24px;">
              <div class="ai-suggestion-box">
                <h4>üìä eBay Market Analysis</h4>

                <div id="photo-detected-item" style="display:none; margin-bottom: 16px;">
                  <p><strong>Detected Item:</strong> <span id="detected-item-name"></span></p>
                </div>

                <div class="kpi-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin: 16px 0;">
                  <div class="kpi">
                    <span class="value" id="valuation-suggested-price">$0</span>
                    <span class="label">Suggested Price</span>
                  </div>
                  <div class="kpi">
                    <span class="value" id="valuation-price-range">$0 - $0</span>
                    <span class="label">Price Range</span>
                  </div>
                  <div class="kpi">
                    <span class="value" id="valuation-sold-count">0</span>
                    <span class="label">Sold Listings</span>
                  </div>
                </div>

                <div class="confidence-bar" style="margin: 16px 0;">
                  <span>Confidence:</span>
                  <div class="progress-bar">
                    <div class="progress-fill" id="valuation-confidence-bar" style="width: 0%"></div>
                  </div>
                  <span id="valuation-confidence-text">0%</span>
                </div>

                <details style="margin-top: 16px;">
                  <summary style="cursor: pointer; font-weight: 500;">View Sample Listings (<span id="sample-listings-count">0</span>)</summary>
                  <div id="sample-listings" style="margin-top: 12px;"></div>
                </details>

                <div class="form-row" style="margin-top: 16px;">
                  <button class="btn ghost" id="clear-valuation-btn">Clear Results</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="screen" id="screen-settings">
          <div class="screen-header">
            <div>
              <h1>Settings</h1>
              <p>Appearance, density, reminders, and safe confirmations.</p>
            </div>
          </div>
          <div class="panel">
            <div class="settings-grid">
              <div>
                <h3>Appearance & theme</h3>
                <label class="row">
                  <span>Theme</span>
                  <select id="theme-select">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="system">System</option>
                  </select>
                </label>
                <label class="row">
                  <span>Color theme</span>
                  <select id="color-theme-select">
                    <option value="peach">Warm Peach (Default)</option>
                    <option value="blue">Modern Blue</option>
                    <option value="purple">Deep Purple</option>
                    <option value="teal">Teal/Cyan</option>
                    <option value="green">Emerald Green</option>
                    <option value="pink">Magenta/Pink</option>
                  </select>
                </label>
                <label class="row">
                  <span>Optional gradients</span>
                  <input type="checkbox" id="enable-gradients" />
                </label>
              </div>
              <div>
                <h3>Density</h3>
                <label class="row">
                  <span>Comfortable</span>
                  <input type="radio" name="density" value="comfortable" checked />
                </label>
                <label class="row">
                  <span>Compact</span>
                  <input type="radio" name="density" value="compact" />
                </label>
              </div>
              <div>
                <h3>Reminders & nudges</h3>
                <label class="row">
                  <span>Weekly review</span>
                  <input type="checkbox" checked />
                </label>
                <label class="row">
                  <span>Draft follow-up</span>
                  <input type="checkbox" checked />
                </label>
              </div>
              <div>
                <h3>Safety confirmations</h3>
                <label class="row">
                  <span>Confirm deletions</span>
                  <input type="checkbox" checked />
                </label>
                <label class="row">
                  <span>Closed period edits</span>
                  <input type="checkbox" checked />
                </label>
              </div>
              <div>
                <h3>Vehicle deductions</h3>
                <label class="row">
                  <span>Mileage</span>
                  <input type="radio" name="vehicle-deduction" value="mileage" checked />
                </label>
                <label class="row">
                  <span>Actual expenses</span>
                  <input type="radio" name="vehicle-deduction" value="actual" />
                </label>
              </div>
              <div>
                <h3>Integrations</h3>
                <div class="row">
                  <span>eBay</span>
                  <button class="btn secondary small" id="ebay-connect-btn">
                    Connect
                  </button>
                </div>
                <p class="hint" id="ebay-status-text" style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);"></p>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div class="menu-overlay" id="menu-overlay"></div>

    <div class="toast" id="toast">
      <span id="toast-message"></span>
      <button id="toast-undo" class="btn ghost small">Undo</button>
    </div>

    <!-- Batch Actions Bar -->
    <div class="batch-actions-bar" id="batch-actions-bar">
      <div class="batch-info">
        <span id="batch-count">0 selected</span>
        <button class="btn ghost tiny" id="batch-clear">Clear</button>
      </div>
      <div class="batch-buttons">
        <button class="btn ghost small" id="batch-export">Export Selected</button>
        <button class="btn ghost small" id="batch-category">Update Category</button>
        <button class="btn ghost small" id="batch-status">Update Status</button>
        <button class="btn ghost small danger" id="batch-delete">Delete Selected</button>
      </div>
    </div>

    <!-- Modal Overlay System -->
    <div class="modal-overlay" id="modal-overlay">
      <div class="modal" id="modal">
        <div class="modal-header">
          <h2 id="modal-title">Modal Title</h2>
          <button class="btn ghost small" id="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Dynamic content loaded here -->
        </div>
        <div class="modal-footer" id="modal-footer">
          <button class="btn ghost" id="modal-cancel">Cancel</button>
          <button class="btn primary" id="modal-save">Save</button>
        </div>
      </div>
    </div>

    <!-- ITEM FORM TEMPLATE -->
    <template id="template-item-form">
      <form id="item-form" class="form">
        <input type="hidden" name="id" />

        <div class="form-row">
          <label>
            <span>Item Name <span class="required">*</span></span>
            <input type="text" name="name" placeholder="Vintage Camera" required />
          </label>
        </div>

        <div class="form-row two-col">
          <label>
            <span>SKU <span class="tooltip" data-tip="Optional unique identifier">‚ìò</span></span>
            <input type="text" name="sku" placeholder="CAM-001" />
            <span class="field-hint" id="sku-hint"></span>
          </label>
          <label>
            <span>Cost <span class="tooltip" data-tip="What you paid (defaults to $0)">‚ìò</span></span>
            <input type="number" name="cost" step="0.01" min="0" value="0" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Description</span>
            <textarea name="description" rows="3" placeholder="Item details..."></textarea>
          </label>
          <button type="button" class="btn ghost small ai-btn" id="enhance-description-btn">
            ‚ú® Enhance with AI
          </button>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Category</span>
            <select name="category" id="item-category">
              <option value="">-- Select --</option>
              <option value="Electronics">Electronics</option>
              <option value="Clothing">Clothing</option>
              <option value="Books">Books</option>
              <option value="Toys">Toys</option>
              <option value="Home & Garden">Home & Garden</option>
              <option value="Collectibles">Collectibles</option>
              <option value="Jewelry">Jewelry</option>
              <option value="Other">Other</option>
            </select>
          </label>
          <div class="ai-suggestion-box" id="ai-category-suggestion" style="display:none;">
            <span class="ai-label">AI Suggestion:</span>
            <span class="ai-value" id="ai-category-value"></span>
            <button type="button" class="btn ghost tiny" id="apply-ai-category">Apply</button>
          </div>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Status</span>
            <select name="status">
              <option value="Unlisted">Unlisted</option>
              <option value="Draft">Draft</option>
              <option value="Listed">Listed</option>
              <option value="Sold">Sold</option>
            </select>
          </label>
          <label>
            <span>Bin Location <span class="tooltip" data-tip="Where this item is stored">‚ìò</span></span>
            <input type="text" name="bin_location" placeholder="A2" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Photos</span>
            <input type="file" id="photo-upload" accept="image/*" capture="environment" multiple />
          </label>
          <div class="photo-preview-grid" id="photo-preview"></div>
          <button type="button" class="btn ghost small ai-btn" id="analyze-photo-btn" disabled>
            ‚ú® Analyze Photo with AI
          </button>
        </div>
      </form>
    </template>

    <!-- SALE FORM TEMPLATE -->
    <template id="template-sale-form">
      <form id="sale-form" class="form">
        <input type="hidden" name="id" />

        <div class="form-row two-col">
          <label>
            <span>Order Number</span>
            <input type="text" name="order_number" placeholder="EV-0192" />
          </label>
          <label>
            <span>Platform <span class="required">*</span></span>
            <select name="platform" required>
              <option value="">-- Select --</option>
              <option value="eBay">eBay</option>
              <option value="Shopify">Shopify</option>
              <option value="Facebook">Facebook Marketplace</option>
              <option value="Mercari">Mercari</option>
              <option value="Other">Other</option>
            </select>
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Sale Date <span class="required">*</span></span>
            <input type="date" name="sale_date" required />
          </label>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Gross Amount <span class="required">*</span></span>
            <input type="number" name="gross_amount" step="0.01" min="0" required />
          </label>
          <label>
            <span>Platform Fees</span>
            <input type="number" name="platform_fees" step="0.01" min="0" value="0" />
          </label>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Promotion Discount <span class="tooltip" data-tip="Discount applied by platform">‚ìò</span></span>
            <input type="number" name="promotion_discount" step="0.01" min="0" value="0" />
          </label>
          <label>
            <span>Shipping Cost</span>
            <input type="number" name="shipping_cost" step="0.01" min="0" value="0" />
          </label>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Florida Tax Collected <span class="tooltip" data-tip="Tax YOU collected (non-eBay)">‚ìò</span></span>
            <input type="number" name="florida_tax_collected" step="0.01" min="0" value="0" />
          </label>
          <label>
            <span>eBay Tax Collected <span class="tooltip" data-tip="Tax eBay collected (informational)">‚ìò</span></span>
            <input type="number" name="ebay_tax_collected" step="0.01" min="0" value="0" />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span class="section-label">Items Sold <span class="required">*</span></span>
          </label>
          <div class="item-picker" id="sale-items-picker">
            <!-- Dynamic item selection -->
          </div>
          <button type="button" class="btn ghost small" id="add-sale-item">+ Add Item</button>
        </div>

        <div class="form-row auto-calc-box">
          <p><strong>Auto-calculated:</strong></p>
          <p>Profit: <span id="calc-profit">$0.00</span></p>
          <p>Federal Tax Estimate: <span id="calc-tax">$0.00</span></p>
        </div>
      </form>
    </template>

    <!-- EXPENSE FORM TEMPLATE -->
    <template id="template-expense-form">
      <form id="expense-form" class="form">
        <input type="hidden" name="id" />

        <div class="form-row">
          <label>
            <span>Expense Name <span class="required">*</span></span>
            <input type="text" name="name" placeholder="Shipping supplies" required />
          </label>
        </div>

        <div class="form-row two-col">
          <label>
            <span>Category <span class="required">*</span></span>
            <select name="category" id="expense-category" required>
              <option value="">-- Select --</option>
              <option value="Inventory">Inventory</option>
              <option value="Shipping">Shipping</option>
              <option value="Packaging">Packaging</option>
              <option value="Office">Office Supplies</option>
              <option value="Software">Software</option>
              <option value="Vehicle">Vehicle</option>
              <option value="Marketing">Marketing</option>
              <option value="Other">Other</option>
            </select>
          </label>
          <label>
            <span>Amount <span class="required">*</span></span>
            <input type="number" name="amount" step="0.01" min="0" required />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Expense Date <span class="required">*</span></span>
            <input type="date" name="expense_date" required />
          </label>
        </div>

        <div class="form-row">
          <label class="section-label">
            <span>Expense Split <span class="tooltip" data-tip="Allocate percentages (must sum to 100)">‚ìò</span></span>
          </label>
          <div class="split-inputs">
            <label>
              <span>Inventory %</span>
              <input type="number" name="split_inventory" min="0" max="100" value="0" step="1" />
            </label>
            <label>
              <span>Operations %</span>
              <input type="number" name="split_operations" min="0" max="100" value="0" step="1" />
            </label>
            <label>
              <span>Other %</span>
              <input type="number" name="split_other" min="0" max="100" value="0" step="1" />
            </label>
          </div>
          <p class="field-hint" id="split-hint">Total: <span id="split-total">0</span>%</p>
          <button type="button" class="btn ghost small ai-btn" id="suggest-split-btn">
            ‚ú® AI Suggest Split
          </button>
        </div>

        <div class="form-row" id="vehicle-deduction-section" style="display:none;">
          <label class="section-label">
            <span>Vehicle Deduction <span class="tooltip" data-tip="Choose mileage OR actual, not both">‚ìò</span></span>
          </label>
          <div class="two-col">
            <label>
              <span>Mileage</span>
              <input type="number" name="vehicle_mileage" step="0.1" min="0" placeholder="Miles" />
            </label>
            <label>
              <span>Actual Expenses</span>
              <input type="number" name="vehicle_actual" step="0.01" min="0" placeholder="$0.00" />
            </label>
          </div>
          <p class="field-hint warning">Note: Cannot use both mileage and actual expenses</p>
        </div>

        <div class="form-row">
          <label>
            <span>Receipt</span>
            <input type="file" id="receipt-upload" accept="image/*,application/pdf" capture="environment" />
          </label>
        </div>
      </form>
    </template>

    <!-- LOT FORM TEMPLATE -->
    <template id="template-lot-form">
      <form id="lot-form" class="form">
        <input type="hidden" name="id" />

        <div class="form-row">
          <label>
            <span>Lot Name <span class="required">*</span></span>
            <input type="text" name="name" placeholder="Vintage Audio Bundle" required />
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Notes</span>
            <textarea name="notes" rows="3" placeholder="Description of lot..."></textarea>
          </label>
        </div>

        <div class="form-row">
          <label class="section-label">
            <span>Items in Lot</span>
          </label>
          <div class="item-multi-select" id="lot-items-picker">
            <!-- Dynamic multi-select -->
          </div>
        </div>

        <div class="form-row auto-calc-box">
          <p><strong>Total Cost (rolled up):</strong> <span id="lot-total-cost">$0.00</span></p>
          <p class="muted">Cost calculated from selected items</p>
        </div>
      </form>
    </template>

    <!-- PRICING DRAFT FORM TEMPLATE -->
    <template id="template-pricing-form">
      <form id="pricing-form" class="form">
        <input type="hidden" name="id" />

        <div class="form-row">
          <label>
            <span>Price For</span>
          </label>
          <div class="radio-group">
            <label>
              <input type="radio" name="price_type" value="item" checked /> Single Item
            </label>
            <label>
              <input type="radio" name="price_type" value="lot" /> Lot/Bundle
            </label>
          </div>
        </div>

        <div class="form-row" id="item-select-row">
          <label>
            <span>Select Item <span class="required">*</span></span>
            <select name="item_id" id="pricing-item-select">
              <option value="">-- Select Item --</option>
            </select>
          </label>
        </div>

        <div class="form-row" id="lot-select-row" style="display:none;">
          <label>
            <span>Select Lot <span class="required">*</span></span>
            <select name="lot_id" id="pricing-lot-select">
              <option value="">-- Select Lot --</option>
            </select>
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>Suggested Price</span>
            <input type="number" name="suggested_price" step="0.01" min="0" placeholder="0.00" />
          </label>
          <button type="button" class="btn ghost small ai-btn" id="suggest-price-btn">
            ‚ú® AI Suggest Price
          </button>
          <div class="ai-suggestion-box" id="ai-price-suggestion" style="display:none;">
            <p><strong>AI Recommendation:</strong></p>
            <p>Range: $<span id="ai-price-min">0</span> - $<span id="ai-price-max">0</span></p>
            <p>Suggested: $<span id="ai-price-suggested">0</span></p>
            <p class="muted" id="ai-price-reasoning"></p>
            <button type="button" class="btn ghost tiny" id="apply-ai-price">Apply Suggested</button>
          </div>
        </div>

        <div class="form-row">
          <label>
            <span>SEO Title (80 char max)</span>
            <input type="text" name="seo_title" maxlength="80" placeholder="eBay listing title..." />
            <p class="field-hint"><span id="title-char-count">0</span>/80</p>
          </label>
        </div>

        <div class="form-row">
          <label>
            <span>SEO Description</span>
            <textarea name="seo_description" rows="5" placeholder="eBay listing description..."></textarea>
          </label>
          <button type="button" class="btn ghost small ai-btn" id="generate-seo-btn">
            ‚ú® Generate SEO with AI
          </button>
        </div>

        <div class="form-row" id="ai-seo-result" style="display:none;">
          <div class="ai-suggestion-box">
            <p><strong>AI-Generated SEO:</strong></p>
            <p><strong>Title:</strong> <span id="ai-seo-title"></span></p>
            <p><strong>Description:</strong></p>
            <p id="ai-seo-description" class="seo-preview"></p>
            <p><strong>Keywords:</strong> <span id="ai-seo-keywords"></span></p>
            <div class="confidence-bar">
              <span>Confidence:</span>
              <div class="progress-bar">
                <div class="progress-fill" id="ai-seo-confidence" style="width: 0%"></div>
              </div>
              <span id="ai-seo-confidence-text">0%</span>
            </div>
            <button type="button" class="btn ghost tiny" id="apply-ai-seo">Apply SEO</button>
          </div>
        </div>
      </form>
    </template>

    <!-- ChatGPT Import Template -->
    <template id="template-chatgpt-import">
      <div class="panel">
        <h4>Import Items from ChatGPT</h4>
        <p class="muted">Upload a CSV file generated by ChatGPT with columns: name, description, category, cost, bin_location, sku (optional)</p>

        <div class="form-row">
          <label>
            <span>CSV File <span class="required">*</span></span>
            <input type="file" id="chatgpt-csv-file" accept=".csv" required />
          </label>
        </div>

        <details style="margin-top: 16px;">
          <summary style="cursor: pointer; font-weight: 500;">How to generate CSV with ChatGPT</summary>
          <pre style="background: var(--panel); padding: 12px; border-radius: 4px; font-size: 12px; margin-top: 8px; overflow-x: auto;">I have the following items to add to my inventory. Generate a CSV with these columns:
name, description, category, cost, bin_location, sku

Items:
[paste your list here]

Format as CSV with headers in first row.</pre>
        </details>
      </div>
    </template>

    <!-- eBay Draft Listing Form Template -->
    <template id="template-ebay-draft">
      <form id="ebay-draft-form" class="form">
        <input type="hidden" name="itemId" />
        <input type="hidden" name="sku" />

        <div class="form-row two-col">
          <div>
            <label>
              <span>Title (max 80 chars) <span class="required">*</span></span>
              <input type="text" name="title" id="ebay-title" maxlength="80" required />
              <p class="field-hint"><span id="ebay-title-char-count">0</span>/80</p>
            </label>
          </div>
          <div>
            <label>
              <span>Price <span class="required">*</span></span>
              <input type="number" name="price" id="ebay-price" step="0.01" min="0.01" required />
            </label>
          </div>
        </div>

        <div class="form-row two-col">
          <div>
            <label>
              <span>Condition <span class="required">*</span></span>
              <select name="condition" id="ebay-condition" required>
                <option value="">-- Select Condition --</option>
                <option value="NEW">New</option>
                <option value="USED_EXCELLENT">Like New</option>
                <option value="USED_GOOD">Good</option>
                <option value="FOR_PARTS_OR_NOT_WORKING">For Parts</option>
              </select>
            </label>
          </div>
          <div>
            <label>
              <span>Quantity <span class="required">*</span></span>
              <input type="number" name="quantity" id="ebay-quantity" value="1" min="1" required />
            </label>
          </div>
        </div>

        <div class="form-row">
          <label>
            <span>Description</span>
            <textarea name="description" id="ebay-description" rows="4" placeholder="Detailed item description..."></textarea>
          </label>
        </div>

        <div class="panel" style="background: var(--bg-alt); padding: 12px; margin-top: 16px;">
          <p class="muted" style="font-size: 14px; margin: 0;">
            <strong>Smart Defaults Applied:</strong><br/>
            ‚Ä¢ Category: Auto-detected by eBay<br/>
            ‚Ä¢ Shipping: USPS Ground Advantage (cheapest)<br/>
            ‚Ä¢ Returns: 30 days accepted<br/>
            ‚Ä¢ Duration: Good 'Til Cancelled<br/>
            ‚Ä¢ Photos: Uploaded from your inventory
          </p>
        </div>

        <div class="panel" style="background: var(--accent-light); padding: 12px; margin-top: 12px;">
          <p style="font-size: 14px; margin: 0;">
            ‚ÑπÔ∏è After creating the draft, you can review and publish it on eBay. We'll open the drafts page for you.
          </p>
        </div>
      </form>
    </template>

    <!-- Floating Action Button (FAB) -->
    <div class="fab-container">
      <button class="fab-main" id="fab-btn" aria-label="Quick Actions">‚ö°</button>
      <div class="fab-menu" id="fab-menu" style="display: none;">
        <button class="fab-option" data-action="quick-add-item">‚ûï Quick Add Item</button>
        <button class="fab-option" data-action="quick-sale">üí∞ Quick Sale</button>
        <button class="fab-option" data-action="quick-expense">üßæ Quick Expense</button>
        <button class="fab-option" data-action="ebay-check">üè∑Ô∏è eBay Check</button>
        <button class="fab-option" data-action="bulk-actions">üì¶ Bulk Actions</button>
      </div>
    </div>

    <script src="/app.js?v=9" type="module"></script>
  </body>
</html>
